<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/vaadin-context-menu/vaadin-context-menu.html">

<dom-module id="analyzer-context-menu">
    <script>
        /**
         * A context-menu element based on the `vaadin-context-menu`.
         *
         * Expands parent functionality adding an ability to adjust position
         * and size relative to a viewport borders (i.e. when open near the viewport borders).
         */
        class AnalyzerContextMenu extends Vaadin.ContextMenuElement {
            static get is() {
                return 'analyzer-context-menu';
            }

            constructor() {
                super();
                this._resizeHandler = this._handleResize.bind(this);
                window.addEventListener("resize", this._resizeHandler);
            }

            disconnectedCallback() {
                super.disconnectedCallback();
                window.removeEventListener("resize", this._resizeHandler);
            }

            open(event) {
                if (!this.opened) {
                    super.open(event);
                    this._alignMenu();
                } else {
                    this.close();
                }
            }

            _alignMenu() {
                const menuElement = document.querySelector("vaadin-context-menu-overlay");
                if (menuElement) {
                    const content = menuElement.$.content;
                    if (content.scrollWidth > content.clientWidth) {
                        const diff = content.scrollWidth - content.clientWidth;
                        menuElement.style.width = (Number.parseInt(menuElement.style.width) + diff) + "px";
                        menuElement.style.left = (Number.parseInt(menuElement.style.left) - diff) + "px";
                    }

                    if (content.scrollHeight > content.clientHeight) {
                        const diff = content.scrollHeight - content.clientHeight;
                        menuElement.style.height = (Number.parseInt(menuElement.style.height) + diff)+ "px";
                        menuElement.style.top = (Number.parseInt(menuElement.style.top) - diff) + "px";
                    }
                }
            }

            _handleResize() {
                if (this.opened) {
                    this.close();
                }
            }
        }

        window.customElements.define(AnalyzerContextMenu.is, AnalyzerContextMenu);
    </script>
</dom-module>

